<!DOCTYPE html>
<html>
<head>
    <title>DoS/DDoS Attack Detector</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        function fetchStats() {
            fetch('/stats')
                .then(response => response.json())
                .then(data => {
                    // Update packets per second
                    const pps = data.stats.packets_per_second;
                    const ppsElem = document.getElementById('pps');
                    ppsElem.innerText = pps;
                    // Color coding
                    if (pps > 500) {
                        ppsElem.className = 'danger';
                    } else if (pps > 100) {
                        ppsElem.className = 'warning';
                    } else {
                        ppsElem.className = 'safe';
                    }

                    // Unique IP count
                    const uniqueIpCount = Object.keys(data.stats.ip_counter).length;
                    document.getElementById('unique-ips').innerText = uniqueIpCount;

                    // Update alert message
                    const alertElem = document.getElementById('alert');
                    alertElem.innerText = data.dos_alert;
                    if (data.dos_alert && data.dos_alert.includes('DDoS detected')) {
                        alertElem.className = 'alert ddos';
                    } else {
                        alertElem.className = 'alert';
                    }

                    // Update top IPs
                    const ipCounter = data.stats.ip_counter;
                    const sortedIps = Object.entries(ipCounter).sort((a, b) => b[1] - a[1]).slice(0, 5);
                    let ipListHtml = '';
                    sortedIps.forEach(([ip, count]) => {
                        ipListHtml += `<li><strong>${ip}</strong>: ${count} packets</li>`;
                    });
                    document.getElementById('top-ips').innerHTML = ipListHtml || '<li>No data</li>';

                    // Update recent alerts
                    const alerts = data.alerts;
                    let alertsHtml = '';
                    alerts.forEach(alert => {
                        alertsHtml += `<li>${alert}</li>`;
                    });
                    document.getElementById('recent-alerts').innerHTML = alertsHtml || '<li>No alerts</li>';

                    // Update advanced threat statistics
                    const advancedStats = data.advanced_stats || {};
                    document.getElementById('port-scans').innerText = advancedStats.port_scans || 0;
                    document.getElementById('brute-force').innerText = advancedStats.brute_force_attempts || 0;
                    document.getElementById('dns-amplification').innerText = advancedStats.dns_amplification || 0;
                    document.getElementById('http-floods').innerText = advancedStats.http_floods || 0;
                    document.getElementById('botnet-activity').innerText = advancedStats.botnet_activity || 0;
                    document.getElementById('total-advanced-threats').innerText = advancedStats.total_advanced_threats || 0;

                    // Update basic packet statistics
                    const tcpPackets = data.stats.tcp_packets || 0;
                    const udpPackets = data.stats.udp_packets || 0;
                    const httpPackets = data.stats.http_packets || 0;
                    const icmpPackets = data.stats.icmp_packets || 0;
                    
                    document.getElementById('tcp-packets').innerText = tcpPackets;
                    document.getElementById('udp-packets').innerText = udpPackets;
                    document.getElementById('http-packets').innerText = httpPackets;
                    document.getElementById('icmp-packets').innerText = icmpPackets;

                    // Update protocol breakdown
                    const protocolStats = advancedStats.protocol_breakdown || {};
                    let protocolHtml = '';
                    Object.entries(protocolStats).forEach(([protocol, count]) => {
                        protocolHtml += `<div class="protocol-stat"><span class="protocol">${protocol}:</span> <span class="count">${count}</span></div>`;
                    });
                    document.getElementById('protocol-breakdown').innerHTML = protocolHtml || '<div>No protocol data</div>';

                    // Update threat summary
                    const threatSummary = data.threat_summary || {};
                    const severityElem = document.getElementById('threat-severity');
                    severityElem.innerText = (threatSummary.severity_level || 'low').toUpperCase();
                    severityElem.className = `severity ${threatSummary.severity_level || 'low'}`;

                    // Update timestamp
                    document.getElementById('timestamp').innerText = new Date().toLocaleTimeString();
                    
                    
                });
        }
        setInterval(fetchStats, 1000);
        window.onload = fetchStats;

        

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('light-mode');
            // Save preference
            if(document.body.classList.contains('light-mode')) {
                localStorage.setItem('theme', 'light');
            } else {
                localStorage.setItem('theme', 'dark');
            }
            updateThemeIcon();
        }
        // On load, set theme from localStorage
        window.addEventListener('DOMContentLoaded', () => {
            if(localStorage.getItem('theme') === 'light') {
                document.body.classList.add('light-mode');
            }
            updateThemeIcon();
        });
        // Update icon based on mode
        function updateThemeIcon() {
            const icon = document.getElementById('theme-icon');
            if(document.body.classList.contains('light-mode')) {
                icon.textContent = '‚òÄÔ∏è';
                icon.title = 'Switch to Dark Mode';
            } else {
                icon.textContent = 'üåô';
                icon.title = 'Switch to Light Mode';
            }
        }
    </script>
</head>
<body>
    <div class="header-bar">
        <h1>DoS/DDoS Attack Detector</h1>
        <button class="toggle-btn" onclick="toggleDarkMode()"><span id="theme-icon">üåô</span></button>
    </div>
    <div class="dashboard-container">
        <!-- Traditional Traffic Monitoring -->
        <div class="card">
            <h2>üö¶ Traffic Overview</h2>
            <div class="stat-row">
                <strong>Packets per second:</strong> <span id="pps" class="safe">0</span>
            </div>
            <div class="stat-row">
                <strong>Unique IPs (last second):</strong> <span id="unique-ips">0</span>
            </div>
            <div id="alert" class="alert"></div>
            <div class="timestamp">Last updated: <span id="timestamp"></span></div>
        </div>

        <!-- Advanced Threat Detection -->
        <div class="card">
            <h2>üõ°Ô∏è Advanced Threat Detection</h2>
            <div class="threat-grid">
                <div class="threat-item">
                    <span class="threat-label">üîç Port Scans:</span>
                    <span id="port-scans" class="threat-count">0</span>
                </div>
                <div class="threat-item">
                    <span class="threat-label">üîê Brute Force:</span>
                    <span id="brute-force" class="threat-count">0</span>
                </div>
                <div class="threat-item">
                    <span class="threat-label">üì° DNS Amplification:</span>
                    <span id="dns-amplification" class="threat-count">0</span>
                </div>
                <div class="threat-item">
                    <span class="threat-label">üåä HTTP Floods:</span>
                    <span id="http-floods" class="threat-count">0</span>
                </div>
                <div class="threat-item">
                    <span class="threat-label">ü§ñ Botnet Activity:</span>
                    <span id="botnet-activity" class="threat-count">0</span>
                </div>
                <div class="threat-item total">
                    <span class="threat-label">‚ö†Ô∏è Total Advanced Threats:</span>
                    <span id="total-advanced-threats" class="threat-count">0</span>
                </div>
            </div>
        </div>

        <!-- Threat Severity -->
        <div class="card">
            <h2>üéØ Threat Level</h2>
            <div class="severity-display">
                <span class="severity-label">Current Threat Level:</span>
                <span id="threat-severity" class="severity low">LOW</span>
            </div>
        </div>



        <!-- Basic Packet Monitoring -->
        <div class="card">
            <h2>üì° Packet Monitoring</h2>
            <div class="packet-stats">
                <div class="packet-stat-row">
                    <strong>TCP Packets/sec:</strong> <span id="tcp-packets" class="packet-count">0</span>
                </div>
                <div class="packet-stat-row">
                    <strong>UDP Packets/sec:</strong> <span id="udp-packets" class="packet-count">0</span>
                </div>
                <div class="packet-stat-row">
                    <strong>HTTP Packets/sec:</strong> <span id="http-packets" class="packet-count">0</span>
                </div>
                <div class="packet-stat-row">
                    <strong>ICMP Packets/sec:</strong> <span id="icmp-packets" class="packet-count">0</span>
                </div>
            </div>
        </div>

        <!-- Protocol Analysis -->
        <div class="card">
            <h2>üìä Protocol Breakdown</h2>
            <div id="protocol-breakdown" class="protocol-stats">
                <div>No protocol data</div>
            </div>
        </div>

        <!-- Top Offending IPs -->
        <div class="card">
            <h2>üéØ Top Offending IPs</h2>
            <ul id="top-ips"></ul>
        </div>

        <!-- Recent Alerts -->
        <div class="card">
            <h2>üö® Recent Alerts</h2>
            <ul id="recent-alerts"></ul>
        </div>
    </div>
</body>
</html>